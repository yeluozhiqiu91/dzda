<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>部门管理</title>
    <meta name="renderer" content="webkit" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/plugins/jedate/jedate.css" />
    <link rel="stylesheet" href="assets/plugins/zTreeStyle/jquery.ztree.css" />
</head>
<body>

<div class="wrapper">

	<!-- header begin -->
	<div class="header">
		<div class="logo">
			<a href="index.html">公安交通档案综合管理系统</a>
		</div>
		<div class="user">
			<ul>
				<li><i class="ico ico-user"></i><span>您好，赵雷</span></li>
				<li><a href="index.html"><i class="ico ico-home"></i>首页</a><i>|</i></li>
				<li><a href="notice.html"><i class="ico ico-notice"></i>通知公告</a><i>|</i></li>
				<li><a href="index.html"><i class="ico ico-edit"></i>修改资料</a><i>|</i></li>
				<li><a href="index.html"><i class="ico ico-lock"></i>修改密码</a><i>|</i></li>
				<li><a href="index.html"><i class="ico ico-logout"></i>退出</a></li>
			</ul>
		</div>
		<div class="menu">
			<div class="item" id="menu1">
				<div class="hd"><a href="#">机动车纸质档案</a></div>
				<div class="bd">
					<dl>
						<dt>
							<a href="javascript:;">
								<span>A库转B库交接</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="ab1.html" id="menu1_1_1"><i class="ico ico1"></i>A库转B库登记</a>
							<a href="ab2.html" id="menu1_1_2"><i class="ico ico2"></i>A库转B库签收</a>
							<a href="ab3.html" id="menu1_1_3"><i class="ico ico3"></i>修改/补打印</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="javascript:;">
								<span>B库转A库交接</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="ba1.html" id="menu1_2_1"><i class="ico ico1"></i>B库转A库登记</a>
							<a href="ba2.html" id="menu1_2_2"><i class="ico ico2"></i>B库转A库签收</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="javascript:;">
								<span>档案审核</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="c.html" id="menu1_3_1"><i class="ico ico8"></i>档案审核</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="javascript:;">
								<span>查询统计</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="d1.html" id="menu1_4_1"><i class="ico ico5"></i>档案查询</a>
							<a href="d2.html" id="menu1_4_2"><i class="ico ico6"></i>交接统计</a>
							<a href="d3.html" id="menu1_4_3"><i class="ico ico7"></i>问题档案查询</a>
						</dd>
					</dl>
				</div>
			</div>

			<div class="item" id="menu2">
				<div class="hd"><a href="#">机动车影像</a></div>
				<div class="bd">
					<dl>
						<dt>
							<a href="javascript:;">
								<span>档案影像</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="e1.html" id="menu2_1_1"><i class="ico ico4"></i>历史档案影像</a>
						</dd>
					</dl>
					<dl>
						<dt>
							<a href="javascript:;">
								<span>查询统计</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="f1.html" id="menu2_2_1"><i class="ico ico5"></i>影像查询</a>
							<a href="f2.html" id="menu2_2_2"><i class="ico ico6"></i>历史档案扫描流水统计</a>
							<a href="f3.html" id="menu2_2_3"><i class="ico ico7"></i>按扫描人员统计</a>
						</dd>
					</dl>
				</div>
			</div>

			<div class="item" id="menu3">
				<div class="hd"><a href="#">档案抽检</a></div>
			</div>
			<div class="item" id="menu4">
				<div class="hd"><a href="#">库房管理</a></div>
			</div>
			<div class="item" id="menu5">
				<div class="hd"><a href="#">综合查询</a></div>
			</div>
			<div class="item" id="menu6">
				<div class="hd"><a href="#">统计分析</a></div>
			</div>
			<div class="item" id="menu7">
				<div class="hd"><a href="#">系统管理</a></div>
				<div class="bd">
					<dl>
						<dt>
							<a href="javascript:;">
								<span>系统管理</span>
								<i class="ico ico-right"></i>
							</a>
						</dt>
						<dd>
							<a href="department.html" id="menu7_1_1"><i class="ico ico9"></i>部门管理</a>
							<a href="role.html" id="menu7_1_2"><i class="ico ico10"></i>角色管理</a>
							<a href="user.html" id="menu7_1_3"><i class="ico ico11"></i>用户管理</a>
						</dd>
					</dl>
				</div>
			</div>
		</div></div>
	<!-- header end -->


	<div class="content">
		<div class="crumbs">
			<span>部门管理</span>
		</div>

		<div class="box">
			
			<div class="filter">
				<form name="filterForm" id="filterForm" action="#" onsubmit="return false;" novalidate>
					<label class="for">部门名称</label>
					<input class="ipt" name="department" type="text">
					<button type="submit" class="ubtn ubtn-primary">查询</button>
				</form>
			</div>

			<div class="operate">
				<button type="button" class="ubtn ubtn-cyan" id="modify">修改</button>
				<button type="button" class="ubtn ubtn-cyan" id="del">删除</button>
				<button type="button" class="ubtn ubtn-cyan" id="add">新增</button>
			</div>
			<div class="ztree-tit"><span>部门结构</span></div>
			<ul class="ztree ztree2" id="department"></ul>

		</div>
	</div>
</div>


<div class="form layer-form layer-form-extra" id="tempForm">
	<div class="title">新增部门</div>
	<form name="form1" onsubmit="return false;">
		<div class="item">
            <div class="txt">部门名称：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="department" data-msg="你还未填写部门名称" />
            </div>
        </div>
		<div class="item">
            <div class="txt">六合一管理部门代码：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="manage"  data-msg="你还未填写六合一管理部门代码" />
            </div>
        </div>
		<div class="item">
            <div class="txt">父级部门：</div>
            <div class="cnt">
            	<select name="parent" class="slt" data-msg="你还未填写父级部门">
					<option value="">请选择</option>
					<option value="15">武汉市交管局</option>
					<option value="16">武汉市交管局车管所</option>
					<option value="17">牌证科</option>
					<option value="19">车管所屯口分局</option>
				</select>
            </div>
        </div>
		<div class="item">
            <div class="txt">排序：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="sort"  />
            </div>
        </div>
		<div class="item">
            <div class="txt">备注：</div>
            <div class="cnt">
            	<input type="text" class="ipt" name="note"  />
            </div>
        </div>
	    <div class="ft">
	        <button type="button" class="ubtn ubtn-gray layer-close">关闭</button>
	        <button type="submit" class="ubtn ubtn-primary submit" style="width:120px;">确定</button>
	    </div>
	</form>
</div>



<script src="assets/js/jquery191.js"></script>
<script src="assets/plugins/jedate/jquery.jedate.js"></script>
<script src="assets/plugins/layer/layer.js"></script>
<script src="assets/plugins/validator/jquery.validator.min.js"></script>
<script src="assets/js/art.template.js"></script>
<script src="assets/js/jquery.pagination.min.js"></script>
<script src="assets/plugins/zTreeStyle/jquery.ztree.min.js"></script>
<script src="assets/js/common.js"></script>

<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) -->
<script src="assets/js/mock.js"></script>
<script>
	Mock.mock('http://g.cn', {
		"result": "SUCCESS",
	    "totalSize": 131,
	    "list|10": [{
		    "id": "@increment",
		    "name": "@ctitle"
		}]
	});

</script>
<!-- 拦截ajax请求并返回虚拟数据(只做演示使用，开发时请删除) end -->

<script>
var zNodes =[
	{ id:1, pId:0, name:"武汉市交管局", open:true},
	{ id:11, pId:1, name:"交管局车管所"},
	{ id:111, pId:11, name:"牌证科"},
	{ id:112, pId:11, name:"车管所屯口分所"},
	{ id:12, pId:1, name:"交管局车管所服务站"},
	{ id:13, pId:1, name:"武汉市江岸大队"}
];


// 设置高亮字体
function setHighlight(treeId, treeNode) {
    return (treeNode.highlight) ? {'color':'#f8503f'} : {};
}
function beforeClick(treeId, treeNode) {
	var zTree = $.fn.zTree.getZTreeObj("department");
	zTree.checkNode(treeNode, !treeNode.checked, null, true);
	return false;
}
function addDiyDom(treeId, treeNode) {
	$("#" + treeNode.tId + "_switch").before('<div class="col1"><label class="cbx" data-id="' + treeNode.id +  '"></label></div>')
}

var _pageInit = {
	init: function() {
		menu('menu7_1_1');
        this.role();
        this.bindEvent();
	},
    role: function() {
    	var $el = $('#department');

        var setting = {
        	view: {
				showLine: false,
				showIcon: false,
				dblClickExpand: false,
				addDiyDom: addDiyDom,
				fontCss: setHighlight
            },
            check: {
            	chkboxType: {"Y":"", "N":""},

                enable: false
            },
            data: {
	            simpleData: {
	                enable: true,
	                idKey: "id",
	                pIdKey: "pId",
	                rootPId: null
	            }
            },
			callback: {
				beforeClick: beforeClick
			}
        };
        var treeObj = $.fn.zTree.init($el, setting, zNodes);

        // 搜索节点
        $('#filterForm').on('submit', function() {
            var value = $.trim($(this).find('.ipt').val());
            value && searchNode(value);
            return false;
        })
        var lastValue = '',
        	nodeList = [];

        var searchNode = function(value) {
            if (lastValue === value || value === '') {
                return;
            }
            lastValue = value;
            updateNodes(false);
            nodeList = treeObj.getNodesByParamFuzzy('name', value);
            updateNodes(true);
        }

        var updateNodes = function(highlight) {
            var i = 0,
                len = nodeList.length;
            for (; i < len; i++) {
                nodeList[i].highlight = highlight;
                treeObj.updateNode(nodeList[i]);
                // 展开搜索到的节点的父节点
                treeObj.expandNode(nodeList[i].getParentNode(), highlight);
            }
        }

        $el.on('click', '.cbx', function() {
        	$(this).toggleClass('cbx-on');
        })
    },
	getNodeId: function(multiple) {
    	var nodeIds = [];
		$('#department').find('.cbx-on').each(function() {
			nodeIds.push($(this).data('id'));
		})
		if (nodeIds.length === 0) {
        	$.notify({'content': '请选择一项进行操作!', type: 'danger'});
		} else if (nodeIds.length > 1 && !multiple) {
			$.notify({'content': '请选择一项进行操作!', type: 'danger'});
        } else {
			return nodeIds;
        }
        return false;
    },
    bindEvent: function() {
		var that = this,
			$temp = $('#tempForm'),
			$form = $temp.find('form'),
			opType = 'add';


		// 验证
		$form.validator({
            fields: {
                department: 'required',
                manage: 'required',
                parent: 'required'
            },
            valid: function(form) {
            	layer.closeAll();
				return false;
            }
        });

		// 新增
		$('#add').on('click', function() {
			opType = 'add';
			$form[0].reset();
			$form.prev('.title').html('新增');
			layer.open({
				area: '540px',
				type: 1,
				title: false,
				content: $temp
			})
		})

        // 修改
        $('#modify').on('click', function() {
        	var id = that.getNodeId();
			opType = 'edit';
			$form[0].reset();
			$form.prev('.title').html('修改');
			if (id) {
				fx.request('http://h.cn', {id: id}, function(res){
					$form.find('.ipt[name="department"]').val(res.data.department);
					$form.find('.ipt[name="manage"]').val(res.data.manage);
					$form.find('.slt[name="parent"]').val(res.data.parent);
					$form.find('.ipt[name="sort"]').val(res.data.sort);
					$form.find('.ipt[name="note"]').val(res.data.note);
					layer.open({
						area: '540px',
						type: 1,
						title: false,
						content: $temp
					})
				});
			}
        })


		// 删除
		$('#del').on('click', function() {
			var id = that.getNodeId(true);
        	var okey = function() {
				fx.request('url', {id: id}, function(res) {

				})
				layer.closeAll();
			}
			id && fx.confirm('确定删除？', okey);
		})


    }
}

</script>
</body>
</html>